# Argo Note MVP - Ralph Loop Prompt

## 実行コマンド

```
/ralph-loop "
## タスク実行ルール

1. `.claude/tasks.md` を読み込む
2. メタ情報の「総イテレーション数」を +1 する
3. 状態が ⬜（未着手）または 🔧（要改善）のタスクを1つ選択
   - Phase順、タスク番号順で優先
   - ❌（ブロック中）と ✅（完了）はスキップ
4. 選択したタスクを実行

## 状態更新ルール

タスク実行後、以下のルールで状態を更新：

- **修正・実装を行った場合** → 🔧（要改善）
  - 次の巡回で再度チェックされる
  - 備考に何を修正したか簡潔に記録

- **修正箇所がなかった場合** → ✅（完了）
  - 問題なし、または既に正しく実装済み
  - 次の巡回ではスキップされる

- **依存関係等で実行不可の場合** → ❌（ブロック中）
  - 備考にブロック理由を記録

## 問題発見・改善提案ルール

タスク実行中に以下を発見した場合：

### 新たな問題を発見した場合
1. `.claude/changelog.md` の「発見された問題 > 未解決」に記録
2. 問題解決用の新タスクを `tasks.md` に追加（該当Phaseの末尾）
3. `.claude/changelog.md` の「追加されたタスク」に記録

### 改善提案がある場合
1. `.claude/changelog.md` の「改善提案 > 採用予定」に記録
2. 改善用の新タスクを `tasks.md` に追加
3. `.claude/changelog.md` の「追加されたタスク」に記録

### 問題を解決した場合
1. 「発見された問題 > 未解決」から「解決済み」に移動
2. 解決方法を記録

## 変更ログ記録ルール

すべての変更を `.claude/changelog.md` に記録：

- **変更履歴**: 全ての修正・実装を記録
- **種別**: 実装/修正/リファクタ/バグ修正/ドキュメント

## 必須アクション

1. `実行回数` を +1 する
2. `最終iter` に現在のイテレーション番号を記録
3. `changelog.md` に変更内容を記録
4. `tasks.md` を保存
5. 変更があれば git commit（メッセージ例: 'iter-42: task 2.3.1 ProductAnalyzer実装'）

## 終了条件

以下の**すべて**を満たしたら `MVP COMPLETE` を出力：

1. 全タスクの状態が ✅ または ❌
2. npm run build が成功
3. npx prisma validate が成功
4. Phase 7 の検証で重大な未解決問題なし
5. changelog.md の「未解決問題」が空

## 注意事項

- 1イテレーション = 1タスクのみ
- コンテキスト節約のため、関係ないファイルは読まない
- 大きな変更は複数イテレーションに分割
- エラーが発生したら備考に記録し、🔧 として次回再試行
- 新タスク追加時は適切なPhaseに配置
" --max-iterations 1000 --completion-promise "MVP COMPLETE"
```

---

## 短縮版プロンプト（推奨）

```
/ralph-loop "
tasks.md読込→iter+1→⬜か🔧のタスク1つ実行→

状態更新:
- 修正あり→🔧（再実行対象）
- 修正なし→✅（スキップ）

問題発見/改善提案時:
- changelog.mdに記録
- tasks.mdに新タスク追加可

変更ログ:
- 全変更をchangelog.mdに記録
- git commit（iter-N: task X.X.X 内容）

終了条件:
- 全タスク✅、build成功、未解決問題なし→MVP COMPLETE
" --max-iterations 1000 --completion-promise "MVP COMPLETE"
```

---

## ファイル構成

```
.claude/
├── tasks.md      # タスク管理表（状態・実行回数）
├── changelog.md  # 変更ログ・問題・提案記録
└── ralph-prompt.md  # このファイル
```

---

## 状態遷移図

```
⬜（未着手）
    ↓ 実行
    ├─ 修正あり → 🔧 → 再実行 → 修正あり → 🔧 → ...
    │                         └─ 修正なし → ✅
    └─ 修正なし → ✅

新問題発見 → changelog記録 → tasks.mdに新タスク追加 → ⬜
改善提案 → changelog記録 → tasks.mdに新タスク追加 → ⬜
```

---

## 期待される動作

1. **第1巡目**: 全タスクを順に実行、実装/修正
2. **問題発見時**: changelog.mdに記録、tasks.mdに新タスク追加
3. **第2巡目以降**: 🔧と新規⬜のタスクを再実行
4. **収束**: 修正がなくなり、新問題も出なくなるまで繰り返し
5. **完了**: ビルド成功、未解決問題なしで `MVP COMPLETE` 出力

---

## タスク追加の例

### 問題発見時
```markdown
## tasks.md への追加例
| 7.9.1 認証トークン更新処理の欠落修正 | ⬜ | 0 | - | iter-45で発見 |

## changelog.md への記録例
### 発見された問題 > 未解決
| P-001 | 45 | 高 | 認証トークン更新処理が未実装 | 7.9.1 |
```

### 改善提案時
```markdown
## tasks.md への追加例
| 7.10.1 LLMレスポンスキャッシュ実装 | ⬜ | 0 | - | iter-78で提案 |

## changelog.md への記録例
### 改善提案 > 採用予定
| I-001 | 78 | LLMレスポンスのキャッシュで API コスト削減 | 7.10.1 |
```
