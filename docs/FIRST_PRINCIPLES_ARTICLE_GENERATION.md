# Argo Note ブログ記事生成 - ファーストプリンシプル分析

> **作成日:** 2026年1月27日
> **目的:** 収集した設計思想・市場調査・技術資産から、ファーストプリンシプルシンキングに基づき、ブログ記事生成の仕様をゼロベースで再構築する
> **参照:** [CONCEPT_DECISIONS.md](./CONCEPT_DECISIONS.md) | [WORDPRESS_BLOG_CONSIDERATIONS.md](./WORDPRESS_BLOG_CONSIDERATIONS.md) | [AIパイプライン仕様](./architecture/04_AI_Pipeline.md) | [RAPID_NOTE_INTEGRATION_TASKS.md](./RAPID_NOTE_INTEGRATION_TASKS.md)

---

## 目次

1. [原子分解 - 根本要素の抽出](#1-原子分解---根本要素の抽出)
2. [第一原理からの問い直し](#2-第一原理からの問い直し)
3. [論理の再構築](#3-論理の再構築)
4. [飛躍的アイデアの導出](#4-飛躍的アイデアの導出)
5. [記事生成仕様への落とし込み](#5-記事生成仕様への落とし込み)
6. [実装ロードマップ](#6-実装ロードマップ)
7. [飛躍的アイデア - 実装仕様詳細](#7-飛躍的アイデア---実装仕様詳細)
8. [コスト見積もりサマリー](#8-コスト見積もりサマリー)
9. [実装優先度マトリクス](#9-実装優先度マトリクス)
10. [次のアクション](#10-次のアクション)

---

## 1. 原子分解 - 根本要素の抽出

### 1.1 Argo Noteの核心的価値

収集したドキュメントから、以下の**不可分な原子要素**を抽出する。

```
┌─────────────────────────────────────────────────────────────────┐
│                    Argo Note の原子構造                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [ターゲット]        [提供価値]           [差別化]              │
│  バイブコーダー  →  集客の自動化  →  オールインワン体験        │
│      │                  │                    │                 │
│      ▼                  ▼                    ▼                 │
│  「作れるが         「マーケティング      「何もしなくて       │
│   届けられない」     の民主化」           いい安心感」         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 記事生成の原子要素

| 原子要素 | 定義 | 存在理由 |
|---------|------|---------|
| **情報収集** | 外部ソースからの知識獲得 | 記事の「材料」を調達 |
| **構造化** | 情報の論理的配置 | 読者の理解を促進 |
| **言語化** | 思考をテキストに変換 | 伝達可能な形式への変換 |
| **最適化** | SEO・読みやすさの向上 | 「見つけてもらう」ための処理 |
| **人間性** | 体験・視点・感情の付与 | 信頼と共感の構築 |
| **視覚化** | 画像・図解による補完 | 理解と記憶の促進 |
| **鮮度維持** | 継続的な情報更新 | 長期的な価値の維持 |

### 1.3 技術資産の原子要素（Rapid-Note2より）

| 資産 | 原子機能 | 統合状態 |
|------|---------|---------|
| **Tavily 3段階検索** | NEWS/SNS/OFFICIAL の多角的情報収集 | ✅ 実装済 |
| **NanoBanana Pro** | テキスト→画像の変換 | ✅ 実装済 |
| **セクション画像挿入** | H2/H3への自動画像配置 | ✅ 実装済 |
| **6ステップパイプライン** | Research→Outline→Content→Meta→Thumbnail→Section Images | ✅ 実装済 |

---

## 2. 第一原理からの問い直し

### 2.1 なぜ人はブログを運営するのか？

```
第一原理: 「届ける」ことで価値を生む

┌──────────────────────────────────────────────────────────────┐
│  表層的な目的           根本的な欲求                         │
├──────────────────────────────────────────────────────────────┤
│  集客したい         →  自分の作品を認知してもらいたい       │
│  SEO上位を取りたい  →  存在を証明したい                     │
│  収益を得たい       →  価値を対価に変換したい               │
│  資産を構築したい   →  時間から解放されたい                 │
└──────────────────────────────────────────────────────────────┘

結論: ブログは「自己表現」と「価値伝達」の手段である
```

### 2.2 なぜAIが記事を書くのか？

```
第一原理: AIは「増幅装置」であり「代替」ではない

┌──────────────────────────────────────────────────────────────┐
│  AIが得意なこと           人間にしかできないこと             │
├──────────────────────────────────────────────────────────────┤
│  情報の網羅的収集     ↔   独自の体験・視点                  │
│  論理的な構造化       ↔   感情・共感の表現                  │
│  大量生成・スケール   ↔   深い専門知識・信念                │
│  24時間稼働           ↔   状況に応じた判断                  │
└──────────────────────────────────────────────────────────────┘

結論: AIは「器」、人間は「魂」を注入する
      最適解は Human-Led AI（人間主導のAI活用）
```

### 2.3 なぜ「真正性」が重要なのか？

```
第一原理: 信頼は人間性から生まれる

Google E-E-A-T の本質的意味:
┌─────────────────────────────────────────────────────────────┐
│  E - Experience (体験)                                       │
│      → 「実際にやってみた」という証拠                       │
│      → AIには物理的体験がない                               │
│                                                              │
│  E - Expertise (専門性)                                      │
│      → 深い知識と洞察                                       │
│      → AIは表面的なまとめになりがち                         │
│                                                              │
│  A - Authoritativeness (権威性)                              │
│      → 誰が言っているかが重要                               │
│      → 匿名AIには権威がない                                 │
│                                                              │
│  T - Trustworthiness (信頼性)                                │
│      → 長期的な一貫性と誠実さ                               │
│      → 人格のあるペルソナが必要                             │
└─────────────────────────────────────────────────────────────┘

結論: AI生成でも「人間らしさ」を注入すれば信頼を構築できる
```

### 2.4 なぜ「自動化」を求めるのか？

```
第一原理: 時間は有限、価値創造に集中したい

バイブコーダーの現実:
┌─────────────────────────────────────────────────────────────┐
│  時間配分の現状              理想の時間配分                  │
├─────────────────────────────────────────────────────────────┤
│  プロダクト開発: 80%    →   プロダクト開発: 80%             │
│  マーケティング: 5%     →   戦略的判断: 15%                 │
│  その他: 15%            →   その他: 5%                      │
│                                                              │
│  課題: マーケティング実行に時間を割けない                   │
│  解決: 「実行」をAIに委任、「判断」は人間が行う             │
└─────────────────────────────────────────────────────────────┘

結論: 自動化の本質は「実行の委任」であり「思考の委任」ではない
```

---

## 3. 論理の再構築

### 3.1 記事生成の新しいフレームワーク

第一原理から導出した「あるべき姿」を定義する。

```
┌─────────────────────────────────────────────────────────────────┐
│            Human-Led AI Article Generation Framework            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│    [人間の領域]                     [AIの領域]                  │
│    ─────────────                    ─────────────                │
│                                                                 │
│    ◆ ビジョン設定                  ◆ 情報収集（Tavily 3段階）  │
│      「何を伝えたいか」               NEWS/SNS/OFFICIAL         │
│                                                                 │
│    ◆ ペルソナ定義                  ◆ 構造化（アウトライン）    │
│      「誰として語るか」               SEO最適化された構成       │
│                                                                 │
│    ◆ 体験の注入                    ◆ ドラフト生成              │
│      「独自の視点・経験」             高品質な下書き作成        │
│                                                                 │
│    ◆ 最終判断                      ◆ 画像生成                  │
│      「公開するか否か」               サムネイル・セクション    │
│                                                                 │
│    ◆ 方向性の修正                  ◆ 継続的更新                │
│      「軌道修正の指示」               フレッシュネス維持        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 品質と真正性の両立モデル

```
記事品質 = f(情報の正確性, 構造の論理性, 人間性の深度)

┌─────────────────────────────────────────────────────────────────┐
│  レベル 1: AI Only（低品質）                                    │
│  ・機械的な文章                                                 │
│  ・一般的なまとめ                                               │
│  ・E-E-A-T不足                                                  │
│  → Google評価: 低、ユーザーエンゲージメント: 低                │
├─────────────────────────────────────────────────────────────────┤
│  レベル 2: AI + 基本人間化（中品質）                            │
│  ・ペルソナ付与                                                 │
│  ・ストーリーテリング要素                                       │
│  ・自然な文体                                                   │
│  → Google評価: 中、ユーザーエンゲージメント: 中                │
├─────────────────────────────────────────────────────────────────┤
│  レベル 3: Human-Led AI（高品質）★目標★                        │
│  ・ユーザー独自の体験を反映                                     │
│  ・専門的洞察の追加                                             │
│  ・一貫したブランドボイス                                       │
│  ・継続的な更新による鮮度維持                                   │
│  → Google評価: 高、ユーザーエンゲージメント: 高                │
└─────────────────────────────────────────────────────────────────┘
```

### 3.3 Argo Noteの価値ポジション

```
市場における位置づけ:

        品質重視
           ▲
           │
     ┌─────┼─────┐
     │     │     │
     │ [専門ライター]
     │     │     │
     │   [Argo Note]★
     │     │     │
手動 ◀─────┼─────▶ 自動
     │     │     │
     │ [AutoBlogging.ai]
     │     │     │
     │[低品質AI量産ツール]
     │     │     │
     └─────┼─────┘
           │
           ▼
        量産重視

差別化ポイント:
・自動化 × 高品質のバランス
・オールインワン体験（WPセットアップ含む）
・Human-Led AIアプローチ
```

---

## 4. 飛躍的アイデアの導出

原子要素と第一原理から、従来の延長線上にない**飛躍的アイデア**を導出する。

### 4.1 「魂の注入」システム

**概念:**
ペルソナを単なるテンプレートではなく、ユーザーの実体験・価値観・声から学習し、記事に深く反映する仕組み。

```
┌─────────────────────────────────────────────────────────────────┐
│                    Soul Injection System                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [入力]                                                         │
│  ・ユーザーのプロダクト説明                                     │
│  ・過去に書いた記事・SNS投稿（任意）                           │
│  ・インタビュー形式での価値観抽出                               │
│  ・「こんな人物として語りたい」という設定                       │
│                                                                 │
│  [処理]                                                         │
│  ・文体・トーン・語彙の学習                                     │
│  ・価値観・信念の抽出                                           │
│  ・独自視点の蓄積                                               │
│                                                                 │
│  [出力]                                                         │
│  ・ユーザー固有の「声」を持った記事                             │
│  ・一貫したブランドボイス                                       │
│  ・読者が「人間が書いた」と感じる自然さ                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

実装案:
1. オンボーディング時に「ライティングスタイル診断」を実施
2. サンプルテキストからスタイルベクトルを抽出
3. 記事生成時にスタイルベクトルを適用
4. フィードバックループで継続的に改善
```

### 4.2 「生きた記事」（Living Article）

**概念:**
記事は公開後も「生きている」存在として、自動的に進化し続ける。

```
┌─────────────────────────────────────────────────────────────────┐
│                    Living Article Concept                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  従来の記事                    生きた記事                       │
│  ─────────────                ─────────────                      │
│                                                                 │
│  公開 → 放置 → 陳腐化        公開 → 監視 → 更新 → 進化       │
│                                     ↑        │                 │
│                                     └────────┘                 │
│                                   (フィードバックループ)        │
│                                                                 │
│  機能:                                                          │
│  ・関連ニュースの自動ウォッチ（Tavily継続検索）                │
│  ・情報の陳腐化を検知                                           │
│  ・更新提案の自動生成                                           │
│  ・ユーザー承認後に自動リライト                                 │
│  ・変更履歴の保持（透明性）                                     │
│                                                                 │
│  効果:                                                          │
│  ・フレッシュネスシグナルの継続的発信                           │
│  ・長期的なSEO価値の維持                                        │
│  ・ユーザーの運用負荷ゼロ                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

実装案（Phase 10以降）:
1. 公開記事に対してTavily検索を定期実行
2. 新情報を検知したらdiffを生成
3. ダッシュボードに更新提案を表示
4. ユーザー承認で自動更新（または自動公開設定）
```

### 4.3 「思考マップ」としての記事クラスター

**概念:**
ピラー・クラスター構造を単なるSEO戦略ではなく、ユーザーのプロダクトに対する「思考の構造化」として可視化。

```
┌─────────────────────────────────────────────────────────────────┐
│                    Thought Map Visualization                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│                    ┌─────────────────┐                         │
│                    │   ピラーページ   │                         │
│                    │ (プロダクトの核) │                         │
│                    └────────┬────────┘                         │
│                             │                                   │
│         ┌───────────────────┼───────────────────┐               │
│         │                   │                   │               │
│  ┌──────▼──────┐    ┌───────▼───────┐   ┌──────▼──────┐        │
│  │課題解決記事 │    │ユースケース記事│   │比較検討記事 │        │
│  │ (TOFU)     │    │   (MOFU)     │   │  (BOFU)    │        │
│  └──────┬──────┘    └───────┬───────┘   └──────┬──────┘        │
│         │                   │                   │               │
│    ┌────┴────┐         ┌────┴────┐        ┌────┴────┐          │
│    │サポート │         │サポート │        │サポート │          │
│    │ 記事群  │         │ 記事群  │        │ 記事群  │          │
│    └─────────┘         └─────────┘        └─────────┘          │
│                                                                 │
│  ユーザーへの提示:                                              │
│  「あなたのプロダクトを、顧客の思考プロセスに沿って            │
│   マッピングしました。この構造で記事を展開します。」            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

実装案:
1. プロダクト分析から購買ファネルを推論（Phase A-B）
2. 思考マップとして視覚的に提示
3. ユーザーが構造を承認/調整
4. 承認後に記事群を順次生成
```

### 4.4 「バイブライティング」体験

**概念:**
バイブコーディングの成功に倣い、自然言語で「こんな記事が欲しい」と伝えるだけで、SEO最適化された高品質記事が生成される体験。

```
┌─────────────────────────────────────────────────────────────────┐
│                    Vibe Writing Experience                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ユーザー入力例:                                                │
│  「私のタスク管理アプリについて、リモートワーカー向けに         │
│   生産性向上の観点から書いてほしい。                           │
│   できれば実際の使用シーンも入れて。」                         │
│                                                                 │
│              ↓                                                  │
│                                                                 │
│  AIの処理:                                                      │
│  1. 意図の解釈 → ターゲット・トーン・構成を推論                │
│  2. Tavily検索 → リモートワーク×生産性の最新情報収集           │
│  3. キーワード最適化 → ロングテール候補を提案                  │
│  4. ペルソナ適用 → ユーザーの声で執筆                          │
│  5. 画像生成 → テーマに合ったビジュアル                        │
│                                                                 │
│              ↓                                                  │
│                                                                 │
│  出力:                                                          │
│  ・SEO最適化されたタイトル案（3案）                            │
│  ・構成案の提示                                                 │
│  ・ユーザー承認後にフル記事生成                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

差別化ポイント:
・競合（ChatGPT等）: 汎用的、ブランド声なし、SEO考慮なし
・Argo Note: プロダクト文脈理解、ブランド声学習済み、SEO最適化
```

### 4.5 「透明性アドバンテージ」

**概念:**
AI生成を隠すのではなく、「AI + 人間」の協業プロセス自体を差別化要因とする。

```
┌─────────────────────────────────────────────────────────────────┐
│                  Transparency Advantage Model                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  従来のアプローチ              透明性アドバンテージ             │
│  ─────────────────             ───────────────────              │
│                                                                 │
│  AI生成を隠す              →   AI + 人間を誇りを持って開示     │
│  「人間が書いた」と装う    →   「AIが調査、人間が監修」と明記  │
│  バレたら信頼低下          →   透明性が信頼を構築              │
│                                                                 │
│  記事フッター例:                                                │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ 📝 この記事について                                     │    │
│  │ ・情報収集: AI (Tavily Search)                          │    │
│  │ ・構成・執筆: AI (Gemini 3.0 Pro)                       │    │
│  │ ・監修・独自視点: [ユーザー名]                          │    │
│  │ ・最終更新: 2026年1月27日                               │    │
│  │                                                         │    │
│  │ AIが効率的に情報を収集・構成し、人間が専門的視点と      │    │
│  │ 体験を追加することで、正確で価値ある記事を提供しています │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
│  効果:                                                          │
│  ・2026年のAI規制トレンドへの先行対応                          │
│  ・「誠実なブランド」としてのポジショニング                    │
│  ・読者との信頼関係構築                                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5. 記事生成仕様への落とし込み

### 5.1 記事生成パイプライン v2.0

飛躍的アイデアを組み込んだ、進化版パイプライン。

```
┌─────────────────────────────────────────────────────────────────┐
│            Article Generation Pipeline v2.0                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Phase 0: Soul Setup（初回のみ）                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ・ライティングスタイル診断                               │   │
│  │ ・ペルソナ定義・学習                                     │   │
│  │ ・プロダクト深掘り                                       │   │
│  │ 出力: User Style Vector                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                         ↓                                       │
│  Phase A-E: 戦略フェーズ（既存）                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ A: プロダクト理解                                        │   │
│  │ B: 購買思考推論                                          │   │
│  │ C: キーワード調査                                        │   │
│  │ D: 競合/SERP分析（Tavily 3段階検索）                     │   │
│  │ E: 記事クラスター設計 → 思考マップとして可視化           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                         ↓                                       │
│  Phase F: 記事生成フェーズ（強化）                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ F1: Research（Tavily多段階 + AI Summary）                │   │
│  │ F2: Outline（SEO最適化構成）                             │   │
│  │ F3: Content（User Style Vector適用）★強化★              │   │
│  │ F4: Meta Description                                     │   │
│  │ F5: Thumbnail（NanoBanana Pro）                          │   │
│  │ F6: Section Images                                       │   │
│  │ F7: Transparency Footer（AI生成開示）★新規★             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                         ↓                                       │
│  Phase G: 継続最適化フェーズ（将来）                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ G1: Living Article Monitor（フレッシュネス監視）★新規★  │   │
│  │ G2: Update Suggestion（更新提案生成）★新規★             │   │
│  │ G3: Performance Feedback（GSCデータ連携）                │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 品質レベル定義

| レベル | 名称 | 内容 | 対象 |
|--------|------|------|------|
| **Lv.1** | Quick Draft | AI生成のみ、基本SEO対策 | 速度重視のテスト記事 |
| **Lv.2** | Standard | ペルソナ適用、ストーリーテリング | 通常の運用記事 |
| **Lv.3** | Premium | 独自視点追加、深い専門性 | ピラーページ、重要記事 |

### 5.3 MVP時点の実装範囲

```
MVP (Phase 6まで):
┌─────────────────────────────────────────────────────────────────┐
│  ✅ 実装済み                                                    │
│  ・Tavily 3段階検索                                             │
│  ・6ステップ生成パイプライン                                    │
│  ・NanoBanana Pro画像生成                                       │
│  ・セクション画像自動挿入                                       │
│                                                                 │
│  🔜 MVP追加実装（推奨）                                         │
│  ・基本ペルソナ設定（テンプレート選択式）                       │
│  ・透明性フッター自動挿入                                       │
│  ・思考マップの簡易可視化                                       │
│                                                                 │
│  📅 Phase 10以降                                                │
│  ・Soul Injection System（スタイル学習）                        │
│  ・Living Article Monitor                                       │
│  ・高度なバイブライティング対話UI                               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 6. 実装ロードマップ

### 6.1 段階的実装計画

| Phase | 内容 | 飛躍的アイデアの組み込み |
|-------|------|------------------------|
| **MVP (1-6)** | 基本パイプライン | 透明性フッター、基本ペルソナ |
| **Phase 7-9** | 拡張機能 | 思考マップ可視化UI |
| **Phase 10** | GSC連携 | Living Article基盤 |
| **Phase 11-12** | 高度化 | Soul Injection, バイブライティング |
| **Phase 15** | Prompt Intelligence | 全機能の最適化ループ |

### 6.2 成功指標

| 指標 | 目標 | 測定方法 |
|------|------|---------|
| **記事品質スコア** | Lv.2以上を80% | 内部評価 + ユーザーフィードバック |
| **E-E-A-T充足率** | 主要項目をクリア | チェックリスト評価 |
| **ユーザー満足度** | 4.0/5.0以上 | NPS調査 |
| **検索順位向上率** | 生成記事の30%が50位以内 | GSCデータ（Phase 10以降） |

---

## まとめ

### 核心的な発見

1. **記事生成の本質:** 「情報の伝達」ではなく「価値の創造」
2. **AIの役割:** 代替ではなく増幅、器に魂を注入するのは人間
3. **真正性の源泉:** 透明性 × 一貫性 × 独自体験
4. **差別化の鍵:** オールインワン × Human-Led × バイブライティング体験

### 次のアクション

1. **即座に実装:** 透明性フッター、基本ペルソナテンプレート
2. **MVP拡張:** 思考マップの簡易可視化
3. **将来計画:** Soul Injection System、Living Article Monitor

---

*本ドキュメントはファーストプリンシプルシンキングに基づき、Argo Noteの設計思想を原子分解し、飛躍的アイデアへと再構築したものです。*

---

## 7. 飛躍的アイデア - 実装仕様詳細

本セクションでは、セクション4で提案した5つの飛躍的アイデアについて、具体的な実装構成を定義する。

### 7.1 Soul Injection System（魂の注入システム）

#### 7.1.1 概要

ユーザー固有のライティングスタイル（文体、トーン、語彙、価値観）を学習し、記事生成時に適用するシステム。

#### 7.1.2 実装アプローチの比較

| アプローチ | 精度 | コスト | 複雑度 | LoRA必要 | 推奨Phase |
|-----------|------|--------|--------|----------|-----------|
| **A: LoRA Fine-tuning** | 高 | 高 | 高 | ✅ 必要 | Phase 15+ |
| **B: Few-shot Learning** | 中-高 | 低 | 低 | ❌ 不要 | **MVP推奨** |
| **C: RAG + Style Examples** | 中 | 中 | 中 | ❌ 不要 | Phase 10 |
| **D: Style Vector Embedding** | 高 | 中 | 中 | 条件付き | Phase 12 |

#### 7.1.3 アプローチA: LoRA Fine-tuning（将来検討）

```
┌─────────────────────────────────────────────────────────────────┐
│                    LoRA Fine-tuning Flow                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [オンボーディング]                                             │
│  ユーザーがサンプルテキスト（10-50記事）をアップロード          │
│       ↓                                                         │
│  [前処理]                                                       │
│  テキストをトレーニング形式に変換                               │
│       ↓                                                         │
│  [Fine-tuning]                                                  │
│  Google Vertex AI でLoRAトレーニング実行                        │
│  所要時間: 1-4時間                                              │
│       ↓                                                         │
│  [デプロイ]                                                     │
│  カスタムエンドポイントとして展開                               │
│       ↓                                                         │
│  [記事生成]                                                     │
│  ユーザー固有モデルで記事生成                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

API呼び出し:
- Fine-tuning: Vertex AI Tuning API × 1回/ユーザー = $5-50/ユーザー
- 推論: Tuned Model Endpoint × 記事生成ごと = 通常の1.2-1.5倍

課題:
- Google Gemini APIのLoRAサポートは限定的（2026年1月時点）
- ユーザーごとのモデル管理コスト
- トレーニングデータの品質依存

結論: 現時点では非推奨。Phase 15以降でGemini LoRAが成熟したら再検討。
```

#### 7.1.4 アプローチB: Few-shot Learning（MVP推奨）

```
┌─────────────────────────────────────────────────────────────────┐
│                    Few-shot Learning Flow                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [オンボーディング時]                                           │
│  Step 1: ユーザーが3-5個のサンプル文章を入力                    │
│          - 過去のブログ記事                                     │
│          - SNS投稿                                              │
│          - 自己紹介文                                           │
│       ↓                                                         │
│  Step 2: スタイル特徴を抽出（LLM解析）                          │
│          - トーン（フォーマル/カジュアル）                      │
│          - 語彙レベル（専門的/平易）                            │
│          - 一人称の使い方（私/僕/俺/なし）                      │
│          - 特徴的なフレーズ                                     │
│       ↓                                                         │
│  Step 3: 「スタイルプロファイル」をDB保存                       │
│                                                                 │
│  [記事生成時]                                                   │
│  Step 4: プロンプトにスタイルプロファイル + サンプル文を挿入    │
│       ↓                                                         │
│  Step 5: 通常の記事生成パイプラインを実行                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

API呼び出し:
- スタイル解析: Gemini 3 Pro × 1回/ユーザー = ~$0.02
- 記事生成（スタイル適用）: 通常 + $0.01/記事（プロンプト増加分）

LoRA必要性: ❌ 不要
```

**データモデル:**
```prisma
model UserStyleProfile {
  id              String   @id @default(cuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id])

  tone            String   // "formal" | "casual" | "friendly" | "professional"
  vocabularyLevel String   // "technical" | "general" | "simple"
  firstPerson     String   // "私" | "僕" | "俺" | "none"
  sentenceStyle   String   // "concise" | "detailed" | "conversational"
  sampleTexts     String[] // 最大5つ
  keyPhrases      String[] // 特徴的な表現

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
```

#### 7.1.5 アプローチC: RAG + Style Examples（Phase 10）

```
┌─────────────────────────────────────────────────────────────────┐
│                    RAG Style System Flow                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [セットアップ]                                                 │
│  Step 1: ユーザーの過去記事をインポート                         │
│  Step 2: 記事をチャンク化（段落単位）                           │
│  Step 3: 各チャンクをEmbedding化（text-embedding-004）          │
│  Step 4: Supabase pgvector に保存                               │
│                                                                 │
│  [記事生成時]                                                   │
│  Step 5: 生成トピックから関連チャンクを検索                     │
│  Step 6: 上位3-5チャンクをプロンプトに挿入                      │
│  Step 7: 「このスタイルで書いて」と指示                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

API呼び出し:
- Embedding生成: text-embedding-004 × チャンク数 = $0.00001/1K tokens
- 類似検索: Supabase pgvector = 無料（DBクエリ）
- 記事生成: 通常 + $0.02/記事

LoRA必要性: ❌ 不要
```

#### 7.1.6 推奨ロードマップ

| Phase | アプローチ | 内容 |
|-------|-----------|------|
| **MVP (Phase 6)** | B: Few-shot | 基本スタイル解析 + プロンプト拡張 |
| **Phase 10** | C: RAG | 過去記事からの類似検索 |
| **Phase 12** | D: Vector | スタイルベクトル（API対応次第） |
| **Phase 15+** | A: LoRA | フルカスタマイズ（需要に応じて） |

---

### 7.2 Living Article（生きた記事）

#### 7.2.1 概要

公開済み記事を継続的に監視し、関連ニュースや情報の陳腐化を検知して自動更新提案を行うシステム。

#### 7.2.2 実装フロー

```
┌─────────────────────────────────────────────────────────────────┐
│                    Living Article System                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [Cron Job: 毎日 or 毎週]                                       │
│  Step 1: 監視対象記事の取得                                     │
│          - status = 'published'                                 │
│          - living_article_enabled = true                        │
│          - last_checked_at < 7日前                              │
│                         ↓                                       │
│  Step 2: 各記事に対してTavily検索                               │
│          - クエリ: 記事のメインキーワード + "最新"              │
│          - 期間: 過去30日                                       │
│          - 深度: basic（コスト削減）                            │
│                         ↓                                       │
│  Step 3: 関連性判定（LLM）                                      │
│          - 検索結果と記事内容を比較                             │
│          - 更新が必要かどうかを判定                             │
│          - 更新箇所と内容を提案                                 │
│                         ↓                                       │
│  Step 4: 更新提案の保存                                         │
│          - article_update_suggestions テーブルに保存            │
│          - ダッシュボードに通知                                 │
│                         ↓                                       │
│  [ユーザーアクション]                                           │
│  Step 5: ユーザーが更新を承認                                   │
│          - 自動適用 or 手動編集                                 │
│                         ↓                                       │
│  Step 6: 記事を更新してWordPressに再公開                        │
│          - 更新日時を記録                                       │
│          - 変更履歴を保持                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 7.2.3 データモデル

```prisma
model ArticleUpdateSuggestion {
  id               String   @id @default(cuid())
  articleId        String
  article          Article  @relation(fields: [articleId], references: [id])

  detectedAt       DateTime @default(now())
  sourceUrl        String?
  sourceTitle      String?

  updateType       String   // "add_info" | "correct_outdated" | "add_example" | "update_stats"
  affectedSection  String?
  currentContent   String
  suggestedContent String
  reasoning        String

  status           String   @default("pending") // "pending" | "approved" | "rejected" | "applied"
  reviewedAt       DateTime?

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model ArticleRevision {
  id           String   @id @default(cuid())
  articleId    String
  article      Article  @relation(fields: [articleId], references: [id])

  version      Int
  content      String
  changeReason String

  createdAt    DateTime @default(now())
}
```

#### 7.2.4 API呼び出しとコスト

| 処理 | API | 回数 | コスト |
|------|-----|------|--------|
| Tavily検索 | Tavily Search | 1回/記事/週 | $0.008 |
| 関連性判定 | Gemini 3 Pro | 1回/記事/週 | ~$0.03 |
| 更新生成（承認時） | Gemini 3 Pro | 1回/更新 | ~$0.10 |

**月間コスト見積もり（100記事監視）:**
```
Tavily: 100記事 × 4週 × $0.008 = $3.20
関連性判定: 100記事 × 4週 × $0.03 = $12.00
更新生成（10%が更新）: 40記事 × $0.10 = $4.00
────────────────────────────────────────
合計: ~$19.20/月
```

#### 7.2.5 LoRA必要性

❌ 不要（通常のLLM推論で十分）

---

### 7.3 Thought Map（思考マップ）

#### 7.3.1 概要

プロダクトの購買ファネルに沿ってピラー・クラスター構造を視覚化し、戦略的な記事展開を支援するシステム。

#### 7.3.2 実装フロー

```
┌─────────────────────────────────────────────────────────────────┐
│                    Thought Map Generation                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [Step 1: プロダクト分析]                                       │
│  入力: プロダクト名・説明、ターゲットユーザー、主要な価値提案   │
│  LLM処理: プロダクトの核心的価値を抽出                          │
│                         ↓                                       │
│  [Step 2: 購買ファネル推論]                                     │
│  LLM処理:                                                       │
│  - TOFU（認知）: どんな課題を持つ人が検索するか                 │
│  - MOFU（検討）: 具体的なユースケースは何か                     │
│  - BOFU（決定）: 競合との比較ポイントは何か                     │
│                         ↓                                       │
│  [Step 3: キーワードクラスター生成]                             │
│  LLM + Tavily処理:                                              │
│  - 各ファネル段階で狙うべきキーワード                           │
│  - Tavily検索で検索ボリューム・競合性を確認                     │
│  - ピラーページとクラスター記事の関係を定義                     │
│                         ↓                                       │
│  [Step 4: 思考マップ構造化]                                     │
│  出力: JSON形式のマップ構造                                     │
│                         ↓                                       │
│  [Step 5: UI可視化]                                             │
│  React Flow / D3.js でインタラクティブなマップを表示            │
│  - ノード: ピラー/クラスター記事                                │
│  - エッジ: 内部リンク関係                                       │
│  - 色分け: TOFU(青)/MOFU(緑)/BOFU(オレンジ)                     │
│  - ステータス: 未生成/生成済み/公開済み                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 7.3.3 データモデル

```prisma
model ThoughtMap {
  id              String   @id @default(cuid())
  siteId          String
  site            Site     @relation(fields: [siteId], references: [id])

  pillarKeyword   String
  pillarIntent    String
  pillarArticleId String?

  clusters        ThoughtMapCluster[]

  version         Int      @default(1)
  status          String   @default("draft") // "draft" | "approved" | "executing"

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model ThoughtMapCluster {
  id           String     @id @default(cuid())
  thoughtMapId String
  thoughtMap   ThoughtMap @relation(fields: [thoughtMapId], references: [id])

  funnelStage  String     // "tofu" | "mofu" | "bofu"
  keyword      String
  intent       String
  priority     Int        @default(0)

  articleId    String?
  article      Article?   @relation(fields: [articleId], references: [id])

  createdAt    DateTime   @default(now())
}
```

#### 7.3.4 API呼び出しとコスト

| 処理 | API | 回数 | コスト |
|------|-----|------|--------|
| プロダクト分析 | Gemini 3 Pro | 1回/サイト | ~$0.05 |
| ファネル推論 | Gemini 3 Pro | 1回/サイト | ~$0.08 |
| キーワード検証 | Tavily Search | 10-20回/サイト | ~$0.16 |
| 構造化 | Gemini 3 Pro | 1回/サイト | ~$0.03 |
| **合計** | | | **~$0.32/サイト（初回のみ）** |

#### 7.3.5 LoRA必要性

❌ 不要

---

### 7.4 Vibe Writing（バイブライティング）

#### 7.4.1 概要

自然言語で「こんな記事が欲しい」と伝えるだけで、意図を解釈しSEO最適化された記事を生成する対話型システム。

#### 7.4.2 実装フロー

```
┌─────────────────────────────────────────────────────────────────┐
│                    Vibe Writing Flow                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [ユーザー入力]                                                 │
│  「私のタスク管理アプリについて、リモートワーカー向けに         │
│   生産性向上の観点から書いてほしい。実際の使用シーンも入れて」  │
│                         ↓                                       │
│  [Step 1: 意図解析] (LLM)                                       │
│  抽出情報:                                                      │
│  - プロダクト: タスク管理アプリ                                 │
│  - ターゲット: リモートワーカー                                 │
│  - 切り口: 生産性向上                                           │
│  - 要素: 使用シーン（体験談風）                                 │
│  - 推定ファネル: MOFU（ユースケース記事）                       │
│                         ↓                                       │
│  [Step 2: キーワード候補生成] (LLM + Tavily)                    │
│  候補:                                                          │
│  1. 「リモートワーク タスク管理 コツ」                          │
│  2. 「在宅勤務 生産性向上 ツール」                              │
│  3. 「テレワーク 仕事効率化 アプリ」                            │
│  Tavily検索で競合状況を確認                                     │
│                         ↓                                       │
│  [Step 3: ユーザー確認UI]                                       │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ 「以下の内容で記事を生成します。よろしいですか？」     │    │
│  │                                                        │    │
│  │ タイトル案:                                            │    │
│  │ ✓ リモートワーカー必見！タスク管理で生産性を2倍に     │    │
│  │ ○ 在宅勤務の生産性を劇的に上げるタスク管理術          │    │
│  │                                                        │    │
│  │ 構成案:                                                │    │
│  │ 1. リモートワークの課題とは                            │    │
│  │ 2. タスク管理が解決する3つの問題                       │    │
│  │ 3. 実際の使用シーン：朝のルーティン                    │    │
│  │ 4. 導入のステップ                                      │    │
│  │                                                        │    │
│  │ [生成する] [修正する]                                  │    │
│  └────────────────────────────────────────────────────────┘    │
│                         ↓                                       │
│  [Step 4: 記事生成パイプライン実行]                             │
│  既存の6ステップパイプライン + Soul Injection                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 7.4.3 API呼び出しとコスト

| 処理 | API | 回数 | コスト |
|------|-----|------|--------|
| 意図解析 | Gemini 3 Pro | 1回 | ~$0.02 |
| キーワード生成 | Gemini 3 Pro | 1回 | ~$0.02 |
| キーワード検証 | Tavily Search | 3回 | ~$0.024 |
| タイトル・構成生成 | Gemini 3 Pro | 1回 | ~$0.03 |
| **Vibe Writing解析合計** | | | **~$0.094** |
| 記事生成（承認後） | 通常パイプライン | - | ~$0.91 |

#### 7.4.4 LoRA必要性

❌ 不要（プロンプトエンジニアリングで対応可能）

---

### 7.5 Transparency Advantage（透明性アドバンテージ）

#### 7.5.1 概要

AI生成を隠すのではなく、「AI + 人間」の協業プロセスを開示することで信頼を構築するシステム。

#### 7.5.2 実装フロー

```
┌─────────────────────────────────────────────────────────────────┐
│                    Transparency Footer System                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [記事生成時]                                                   │
│  生成プロセスのメタデータを記録:                                │
│  - 情報収集: Tavily Search API                                  │
│  - 記事生成: Gemini 3.0 Pro                                     │
│  - 画像生成: NanoBanana Pro (kie.ai)                            │
│  - 生成日時                                                     │
│  - 監修者（ユーザー名）                                         │
│                         ↓                                       │
│  [WordPress投稿時]                                              │
│  記事末尾にTransparency Footerを自動挿入:                       │
│                                                                 │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ 📝 この記事について                                    │    │
│  │                                                        │    │
│  │ 本記事は、AI技術と人間の専門知識を組み合わせて         │    │
│  │ 作成されています。                                     │    │
│  │                                                        │    │
│  │ ・情報収集: AI (Tavily Search)                         │    │
│  │ ・構成・執筆: AI (Google Gemini)                       │    │
│  │ ・専門的監修: [ユーザー表示名]                         │    │
│  │ ・最終更新: 2026年1月27日                              │    │
│  │                                                        │    │
│  │ AIが効率的に情報を収集・整理し、専門家が               │    │
│  │ 正確性と独自の視点を追加しています。                   │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 7.5.3 ユーザー設定オプション

```prisma
model SiteSettings {
  id                     String  @id @default(cuid())
  siteId                 String  @unique
  site                   Site    @relation(fields: [siteId], references: [id])

  transparencyEnabled    Boolean @default(true)
  transparencyStyle      String  @default("full") // "full" | "minimal" | "custom"
  customTransparencyText String?
  showModelNames         Boolean @default(true)
  showSupervisorName     Boolean @default(true)
}
```

#### 7.5.4 API呼び出しとコスト

| 処理 | API | 回数 | コスト |
|------|-----|------|--------|
| フッター生成 | なし（テンプレート） | - | **$0** |

#### 7.5.5 LoRA必要性

❌ 不要

---

## 8. コスト見積もりサマリー

### 8.1 機能別コスト（1記事あたり）

| 機能 | 追加API呼び出し | 追加コスト | LoRA必要 |
|------|----------------|-----------|----------|
| **Soul Injection (Few-shot)** | LLM 1回 (初回解析) | +$0.01/記事 | ❌ |
| **Living Article** | Tavily 1回 + LLM 1回 /週 | +$0.038/記事/週 | ❌ |
| **Thought Map** | LLM 3回 + Tavily 15回 /サイト | ~$0.32/サイト (初回のみ) | ❌ |
| **Vibe Writing** | LLM 3回 + Tavily 3回 | +$0.094/記事 | ❌ |
| **Transparency Footer** | なし | $0 | ❌ |

### 8.2 フェーズ別実装コスト

| Phase | 機能 | 開発工数 | 月間運用コスト (100記事) |
|-------|------|---------|-------------------------|
| **MVP** | Transparency Footer | 2時間 | $0 |
| **MVP** | Soul Injection (基本) | 8時間 | +$1/月 |
| **Phase 10** | Living Article | 16時間 | +$19/月 |
| **Phase 10** | Thought Map | 12時間 | +$3/月 (10サイト) |
| **Phase 12** | Vibe Writing | 20時間 | +$9/月 |

---

## 9. 実装優先度マトリクス

```
                     高
                      │
        効果/ROI      │  ★ Transparency    ★ Vibe Writing
                      │    Footer             (Phase 12)
                      │
                      │  ★ Soul Injection  ★ Living Article
                      │    (Few-shot)         (Phase 10)
                      │
                      │                    ★ Thought Map
                      │                      (Phase 10)
                     低
                      └────────────────────────────────────
                       低                 実装難易度                高
```

### 9.1 推奨実装順序

| 順位 | 機能 | Phase | 理由 |
|------|------|-------|------|
| 1 | Transparency Footer | MVP | 実装が簡単、差別化効果大 |
| 2 | Soul Injection (Few-shot) | MVP | ユーザー体験向上、低コスト |
| 3 | Thought Map | Phase 10 | 戦略性向上、初回のみのコスト |
| 4 | Living Article | Phase 10 | 長期的SEO価値、継続コスト |
| 5 | Vibe Writing | Phase 12 | UX革新、やや複雑 |

---

## 10. 次のアクション

### 10.1 MVP（即座に実装可能）

- [ ] Transparency Footer テンプレート実装
- [ ] SiteSettings テーブル追加
- [ ] WordPress投稿時のフッター挿入
- [ ] UserStyleProfile テーブル追加
- [ ] オンボーディング時のスタイル診断UI
- [ ] 記事生成プロンプトへのスタイル適用

### 10.2 Phase 10

- [ ] ThoughtMap / ThoughtMapCluster テーブル追加
- [ ] 思考マップ生成API
- [ ] React Flow での可視化UI
- [ ] Living Article Monitor Inngest Function
- [ ] ArticleUpdateSuggestion テーブル追加
- [ ] 更新提案ダッシュボードUI

### 10.3 Phase 12

- [ ] Vibe Writing 対話UI
- [ ] 意図解析API
- [ ] キーワード候補生成ロジック
- [ ] 確認・修正フロー

---

## 11. 追加検討機能（2026年1月29日追記）

本セクションでは、記事生成における追加機能として検討が必要な3つの機能を定義する。

### 11.1 商品誘導機能（Product Call-to-Action）

#### 11.1.1 概要

記事の文末や適切な箇所で、最終的に販売したい商品やその商品を説明するページへの自然な誘導を行う機能。

#### 11.1.2 要件

```
┌─────────────────────────────────────────────────────────────────┐
│              Product Call-to-Action System                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [入力]                                                         │
│  ・商品名                                                       │
│  ・商品URL（販売ページ/説明ページ）                             │
│  ・商品の特徴・ベネフィット                                     │
│  ・CTA（Call-to-Action）テキスト例                             │
│  ・誘導スタイル（自然/直接的）                                  │
│                                                                 │
│  [配置パターン]                                                 │
│  A. 記事末尾（標準）                                            │
│     - 記事の結論後に自然な流れでCTAセクションを追加             │
│  B. 文中挿入（オプション）                                      │
│     - 関連するセクションの終わりにソフトCTAを挿入               │
│  C. サイドバーウィジェット（WordPress連携時）                   │
│     - 記事横に固定CTAを表示                                      │
│                                                                 │
│  [出力例（記事末尾）]                                           │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ ## まとめ                                               │    │
│  │ ○○について解説しました。効率的な○○には適切な            │    │
│  │ ツールの活用が欠かせません。                            │    │
│  │                                                         │    │
│  │ [商品名]は、本記事で紹介した課題を解決するために         │    │
│  │ 設計されています。詳しくは以下をご覧ください。          │    │
│  │                                                         │    │
│  │ 👉 [商品名を詳しく見る](商品URL)                        │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.1.3 データモデル

```prisma
model ProductCTA {
  id              String   @id @default(cuid())
  siteId          String
  site            Site     @relation(fields: [siteId], references: [id])

  productName     String
  productUrl      String
  productBenefit  String   // 主要ベネフィット（1-2文）
  ctaText         String   // CTAボタンテキスト
  ctaStyle        String   @default("natural") // "natural" | "direct" | "soft"

  placement       String   @default("footer") // "footer" | "inline" | "both"
  isActive        Boolean  @default(true)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
```

#### 11.1.4 実装フェーズ

**推奨Phase:** MVP（Phase 6）
**理由:** ブログの収益化に直結する重要機能。実装難易度も低い。

---

### 11.2 ペルソナ機能（Writer Persona System）

#### 11.2.1 概要

AIライターに人間らしい「人格」を設定し、感情表現・ストーリーテリング・体験風の語り口を実現する機能。

**重要設計原則: 事前登録→選択方式**
- ペルソナは**専用の管理画面で事前に登録**しておく
- 記事生成時に登録済みペルソナを**選択して適用**する
- 複数のペルソナを登録し、記事の目的に応じて使い分け可能（ソフトコーディング）

#### 11.2.2 システム構成

```
┌─────────────────────────────────────────────────────────────────┐
│          Writer Persona System - アセット管理方式               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [Phase 1: ペルソナ管理画面（/settings/personas）]              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ペルソナ一覧                                 [+新規作成] │   │
│  │ ─────────────────────────────────────────────────────── │   │
│  │ ☑ プロフェッショナル田中 (プリセット)           [編集]  │   │
│  │ ☑ テック好きユウキ (プリセット)                 [編集]  │   │
│  │ ☑ 解説上手なアカネ先生 (プリセット)             [編集]  │   │
│  │ ─────────────────────────────────────────────────────── │   │
│  │ ★ マイペルソナ1: 業界専門家                    [編集]  │   │
│  │ ★ マイペルソナ2: カジュアルブロガー            [編集]  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                         │                                       │
│                         ▼                                       │
│  [Phase 2: 記事生成画面（/articles/new）]                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 記事生成設定                                             │   │
│  │ ─────────────────────────────────────────────────────── │   │
│  │ ライターペルソナ: [▼ ペルソナを選択              ]       │   │
│  │                   ├─ なし（デフォルト）                  │   │
│  │                   ├─ プロフェッショナル田中              │   │
│  │                   ├─ テック好きユウキ                    │   │
│  │                   ├─ 解説上手なアカネ先生                │   │
│  │                   ├─ マイペルソナ1: 業界専門家           │   │
│  │                   └─ マイペルソナ2: カジュアルブロガー   │   │
│  │                                                          │   │
│  │ ターゲットキーワード: [                    ]             │   │
│  │ 記事タイプ: [▼ 記事 / FAQ / 用語集          ]           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.2.3 Soul Injection System との統合

既存の **Soul Injection System**（セクション7.1）を拡張し、ペルソナ機能として再定義する。

**ペルソナの構成要素:**
```
┌─────────────────────────────────────────────────────────────────┐
│  [Soul Injection 既存要素]                                      │
│  ・文体（フォーマル/カジュアル）                                │
│  ・語彙レベル（専門的/平易）                                    │
│  ・一人称スタイル                                               │
│                                                                 │
│  [新規追加: ペルソナ要素]                                       │
│  ・ペルソナ名・プロフィール                                     │
│  ・性格特性（明るい/落ち着いた/熱量高い等）                     │
│  ・感情表現の度合い（控えめ/適度/豊か）                         │
│  ・ストーリーテリングスタイル                                   │
│    - 体験談風（「実際に試してみたところ...」）                  │
│    - 教師風（「ここで重要なのは...」）                          │
│    - 友人風（「これ、めっちゃいいよ！」）                       │
│  ・口癖・特徴的なフレーズ                                       │
│                                                                 │
│  [プリセットペルソナ例]                                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 🧑‍💼 プロフェッショナル田中                                 │   │
│  │ ・冷静で論理的な語り口                                    │   │
│  │ ・データや事実を重視                                      │   │
│  │ ・「〜することをお勧めします」「検証結果によると〜」      │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 👩‍💻 テック好きユウキ                                       │   │
│  │ ・カジュアルで親しみやすい                                │   │
│  │ ・体験談を交えた語り口                                    │   │
│  │ ・「正直、最初は半信半疑だったんですけど...」             │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 🎓 解説上手なアカネ先生                                   │   │
│  │ ・わかりやすい説明                                        │   │
│  │ ・例え話を多用                                            │   │
│  │ ・「つまり、○○は△△のようなものです」                    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.2.4 データモデル

```prisma
model WriterPersona {
  id                  String    @id @default(cuid())
  userId              String?   // null = システムプリセット
  user                User?     @relation(fields: [userId], references: [id])

  name                String    // ペルソナ名（表示用）
  description         String?   // 説明文
  profile             String?   // 詳細プロフィール

  // Soul Injection 要素
  tone                String    // "formal" | "casual" | "friendly" | "professional"
  vocabularyLevel     String    // "technical" | "general" | "simple"
  firstPerson         String    // "私" | "僕" | "俺" | "none"

  // ペルソナ要素
  personalityTraits   String[]  // ["cheerful", "calm", "passionate", "analytical"]
  emotionLevel        String    @default("moderate") // "minimal" | "moderate" | "expressive"
  storytellingStyle   String    @default("balanced") // "experiential" | "educational" | "conversational" | "balanced"
  signaturePhrases    String[]  // 口癖・特徴的フレーズ

  // 管理フラグ
  isPreset            Boolean   @default(false)  // システムプリセットか
  isActive            Boolean   @default(true)   // 有効/無効
  sortOrder           Int       @default(0)      // 表示順

  // 使用履歴
  articles            Article[] // このペルソナで生成された記事

  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
}

// Article モデルに追加
model Article {
  // ... 既存フィールド

  personaId           String?
  persona             WriterPersona? @relation(fields: [personaId], references: [id])
}
```

#### 11.2.5 API設計

```typescript
// ペルソナ管理API
GET    /api/personas          // ペルソナ一覧取得（プリセット + ユーザー作成）
POST   /api/personas          // 新規ペルソナ作成
GET    /api/personas/:id      // ペルソナ詳細取得
PUT    /api/personas/:id      // ペルソナ更新
DELETE /api/personas/:id      // ペルソナ削除（プリセット以外）

// 記事生成時の使用
POST   /api/articles/generate
{
  "targetKeyword": "...",
  "personaId": "cuid_xxx",    // 選択したペルソナID（null許可）
  "articleType": "article",
  // ...
}
```

#### 11.2.6 実装フェーズ

**推奨Phase:** MVP（基本）→ Phase 10（拡張）
- **MVP:**
  - プリセットペルソナ3種類
  - 記事生成時の選択UI
- **Phase 10:**
  - カスタムペルソナ作成機能
  - 高度なペルソナ学習（ユーザーサンプル文からの自動抽出）

---

### 11.3 Trace機能（Writing Style Trace）

#### 11.3.1 概要

特定の文章サンプルを解析し、その文体・語彙・表現の特徴を捉えて模倣する**独立モジュール**。

**重要設計原則:**
- **完全独立モジュール**: 他の機能に依存せず単体で動作
- **事前登録→選択方式**: 専用管理画面でスタイルを解析・登録し、記事生成時に選択して適用
- **アセットとして管理**: 解析済みスタイルプロファイルを再利用可能なアセットとして保存

#### 11.3.2 システム構成

```
┌─────────────────────────────────────────────────────────────────┐
│         Writing Style Trace System - アセット管理方式           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [Phase 1: Trace登録画面（/settings/style-traces）]             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ スタイルトレース一覧                         [+新規登録] │   │
│  │ ─────────────────────────────────────────────────────── │   │
│  │ ★ 競合サイトA風             解析済み ✓        [詳細]   │   │
│  │    ソース: https://example.com/article                  │   │
│  │                                                          │   │
│  │ ★ 自分の過去記事スタイル    解析済み ✓        [詳細]   │   │
│  │    ソース: テキスト入力（2,500文字）                    │   │
│  │                                                          │   │
│  │ ★ ニュースメディア風        解析済み ✓        [詳細]   │   │
│  │    ソース: https://news-site.com/tech                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [新規登録フロー]                                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ スタイルトレース新規登録                                 │   │
│  │ ─────────────────────────────────────────────────────── │   │
│  │ 名前: [競合サイトA風                    ]               │   │
│  │                                                          │   │
│  │ 入力方式:                                                │   │
│  │ ○ URL指定   ● テキスト入力                              │   │
│  │                                                          │   │
│  │ 参考テキスト:                                            │   │
│  │ ┌────────────────────────────────────────────────────┐  │   │
│  │ │ ここに参考にしたい文章をペーストしてください。    │  │   │
│  │ │ 記事全文、メルマガ、ブログ記事など、文体を       │  │   │
│  │ │ 学習させたいテキストを入力します。               │  │   │
│  │ └────────────────────────────────────────────────────┘  │   │
│  │                                                          │   │
│  │                    [解析して登録]                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                         │                                       │
│                         ▼ 解析実行（LLM）                       │
│                         │                                       │
│  [Phase 2: 記事生成画面（/articles/new）]                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 記事生成設定                                             │   │
│  │ ─────────────────────────────────────────────────────── │   │
│  │ ライターペルソナ: [▼ マイペルソナ1              ]       │   │
│  │                                                          │   │
│  │ スタイルトレース: [▼ スタイルを選択             ]       │   │
│  │                   ├─ なし（ペルソナのみ適用）           │   │
│  │                   ├─ 競合サイトA風                       │   │
│  │                   ├─ 自分の過去記事スタイル              │   │
│  │                   └─ ニュースメディア風                  │   │
│  │                                                          │   │
│  │ ※ペルソナとトレースは併用可能（トレースが優先適用）    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.3.3 解析プロセス

```
┌─────────────────────────────────────────────────────────────────┐
│                    Style Trace 解析フロー                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [入力]                                                         │
│  A. URL指定                                                     │
│     - 参考にしたい記事のURLを入力                               │
│     - WebScraperでコンテンツを取得                              │
│  B. テキスト直接入力                                            │
│     - ユーザーが参考文章をペースト                              │
│     - 既存の自分の記事やメルマガ等                              │
│                                                                 │
│  [解析プロセス（LLM実行）]                                      │
│  Step 1: 文章構造の解析                                         │
│  ・見出し構成パターン                                           │
│  ・段落の長さ・リズム                                           │
│  ・リスト・箇条書きの使用頻度                                   │
│                                                                 │
│  Step 2: 語彙・表現の解析                                       │
│  ・使用語彙のレベル                                             │
│  ・特徴的なフレーズ・言い回し                                   │
│  ・接続詞の使い方                                               │
│  ・修飾語の頻度・種類                                           │
│                                                                 │
│  Step 3: トーン・感情の解析                                     │
│  ・フォーマル度                                                 │
│  ・感情表現の傾向                                               │
│  ・読者への呼びかけ方                                           │
│                                                                 │
│  [出力: スタイルプロファイル（DB保存）]                         │
│  {                                                              │
│    "structurePattern": "h2-intro-list-h3-detail",               │
│    "paragraphStyle": "short",  // 1段落3-4文                    │
│    "vocabularyLevel": "general",                                │
│    "formalityScore": 0.6,      // 0=カジュアル, 1=フォーマル    │
│    "emotionScore": 0.4,        // 0=淡白, 1=感情豊か            │
│    "keyPhrases": ["実際に", "〜してみた", "正直なところ"],      │
│    "connectorStyle": ["というのも", "つまり", "だからこそ"],    │
│    "readerAddress": "あなた"                                    │
│  }                                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.3.4 データモデル

```prisma
model StyleTrace {
  id                  String    @id @default(cuid())
  userId              String
  user                User      @relation(fields: [userId], references: [id])

  // 基本情報
  name                String    // トレース名（ユーザー命名）
  description         String?   // 説明文

  // ソース情報
  sourceType          String    // "url" | "text"
  sourceUrl           String?   // URL指定の場合
  sourceText          String?   @db.Text  // テキスト入力の場合
  sourceTitle         String?   // 取得した記事タイトル（URL指定時）

  // 解析結果（スタイルプロファイル）
  structurePattern    String    // 構成パターン
  paragraphStyle      String    // "short" | "medium" | "long"
  vocabularyLevel     String    // "technical" | "general" | "simple"
  formalityScore      Float     // 0.0 - 1.0
  emotionScore        Float     // 0.0 - 1.0
  keyPhrases          String[]  // 特徴的フレーズ
  connectorStyle      String[]  // 接続詞スタイル
  readerAddress       String?   // 読者への呼びかけ方

  // 解析メタデータ
  analyzedAt          DateTime  // 解析実行日時
  analyzerModel       String    // 使用したLLMモデル
  confidenceScore     Float?    // 解析の信頼度

  // 管理フラグ
  isActive            Boolean   @default(true)
  sortOrder           Int       @default(0)

  // 使用履歴
  articles            Article[] // このトレースで生成された記事

  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
}

// Article モデルに追加
model Article {
  // ... 既存フィールド

  personaId           String?
  persona             WriterPersona? @relation(fields: [personaId], references: [id])

  styleTraceId        String?
  styleTrace          StyleTrace? @relation(fields: [styleTraceId], references: [id])
}
```

#### 11.3.5 API設計

```typescript
// スタイルトレース管理API
GET    /api/style-traces          // トレース一覧取得
POST   /api/style-traces          // 新規トレース作成（解析実行）
GET    /api/style-traces/:id      // トレース詳細取得
PUT    /api/style-traces/:id      // トレース更新（名前・説明のみ）
DELETE /api/style-traces/:id      // トレース削除
POST   /api/style-traces/:id/reanalyze  // 再解析実行

// 記事生成時の使用
POST   /api/articles/generate
{
  "targetKeyword": "...",
  "personaId": "cuid_xxx",        // 選択したペルソナID（null許可）
  "styleTraceId": "cuid_yyy",     // 選択したトレースID（null許可）
  "articleType": "article",
  // ...
}
```

#### 11.3.6 ペルソナ機能との関係

```
┌─────────────────────────────────────────────────────────────────┐
│             ペルソナ × トレース の組み合わせ                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [組み合わせパターン]                                           │
│                                                                 │
│  1. ペルソナのみ                                                │
│     → ペルソナの設定に基づいて記事生成                         │
│                                                                 │
│  2. トレースのみ                                                │
│     → トレースのスタイルに基づいて記事生成                     │
│                                                                 │
│  3. ペルソナ + トレース（併用）                                 │
│     → ペルソナの人格設定 + トレースの文体を組み合わせ          │
│     → トレースの語彙・構成が優先、ペルソナの感情表現を適用     │
│                                                                 │
│  4. どちらもなし                                                │
│     → デフォルトの記事生成（従来通り）                         │
│                                                                 │
│  [重要: 独立性の維持]                                           │
│  ・トレースはペルソナに依存しない                               │
│  ・トレースからペルソナを作成する機能は将来検討                 │
│  ・それぞれ独立した管理画面・APIを持つ                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.3.7 実装フェーズ

**推奨Phase:** Phase 10
**理由:** 独立モジュールとして実装。MVP後の品質向上フェーズで追加。

**実装ステップ:**
1. StyleTraceテーブル追加
2. スタイル解析ロジック実装（LLMプロンプト）
3. 管理画面UI実装（/settings/style-traces）
4. 記事生成画面への選択UI追加
5. 記事生成パイプラインへのトレース適用ロジック追加

---

### 11.4 記事リライト機能（Article Rewrite System）

#### 11.4.1 概要

一度投稿した記事を定期的または手動でリライト（更新）する機能。これはSEO戦略において**必須機能**であり、以下の理由から不可欠である：

- **検索順位維持:** Googleは鮮度を重視し、古い記事は順位が下がる
- **情報の正確性:** 時間経過により情報が古くなる
- **競合対策:** 競合が更新した内容に対応
- **ユーザー価値:** 常に最新・正確な情報を提供

#### 11.4.2 システム構成

```
┌─────────────────────────────────────────────────────────────────┐
│              Article Rewrite System - 全体構成                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [入力ソース]                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 1. 元記事データ                                          │   │
│  │    - 現在の記事HTML/メタデータ                           │   │
│  │    - 記事の目標・哲学（ArticleGoal）                      │   │
│  │    - 過去のリライト履歴                                   │   │
│  │                                                          │   │
│  │ 2. 外部情報収集                                          │   │
│  │    - Tavily 3段階検索（最新ニュース・SNS・公式情報）      │   │
│  │    - 競合記事分析                                        │   │
│  │    - Google検索結果の変化                                │   │
│  │                                                          │   │
│  │ 3. GSC連携データ（オプション）                           │   │
│  │    - クリック数・インプレッション推移                     │   │
│  │    - 順位変動アラート                                     │   │
│  │    - 検索クエリの変化                                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                         │                                       │
│                         ▼                                       │
│  [リライト判定エンジン]                                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ・定期スケジュール（30日/60日/90日等）                    │   │
│  │ ・GSCトリガー（順位低下検知時）                           │   │
│  │ ・手動トリガー（ユーザー指示）                            │   │
│  │ ・イベントトリガー（関連ニュース検知）                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                         │                                       │
│                         ▼                                       │
│  [リライトパイプライン]                                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ R1. 現状分析                                              │   │
│  │     - 元記事の構造・品質評価                              │   │
│  │     - 競合記事との差分分析                                │   │
│  │                                                          │   │
│  │ R2. 情報収集                                              │   │
│  │     - Tavily検索で最新情報取得                            │   │
│  │     - 競合記事のスクレイピング                            │   │
│  │                                                          │   │
│  │ R3. リライト方針決定                                      │   │
│  │     - 記事目標との整合性チェック                          │   │
│  │     - 更新強度の決定（軽微/中程度/大幅）                  │   │
│  │                                                          │   │
│  │ R4. コンテンツ更新                                        │   │
│  │     - 新情報の追加・古い情報の削除                        │   │
│  │     - 構成の最適化                                        │   │
│  │     - SEO要素の更新                                       │   │
│  │                                                          │   │
│  │ R5. 差分レビュー                                          │   │
│  │     - 変更箇所のハイライト表示                            │   │
│  │     - ユーザー承認フロー                                  │   │
│  │                                                          │   │
│  │ R6. 公開・履歴記録                                        │   │
│  │     - WordPress更新                                       │   │
│  │     - リライト履歴保存                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.4.3 記事目標・哲学機能（Article Goal）

リライト時に記事の一貫性を保つため、各記事に「目標・哲学」を設定する。

```
┌─────────────────────────────────────────────────────────────────┐
│                   Article Goal 設定項目                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [基本目標]                                                     │
│  ・ターゲット読者: 誰に向けた記事か                            │
│  ・記事の主目的: 教育/販売促進/ブランディング/リード獲得       │
│  ・伝えたいメッセージ: 記事で一番伝えたい核心                  │
│                                                                 │
│  [SEO目標]                                                      │
│  ・主要キーワード: 狙うキーワード（複数可）                    │
│  ・目標順位: 1位/3位以内/10位以内                              │
│  ・競合URL: ベンチマークする競合記事                           │
│                                                                 │
│  [コンテンツ方針]                                               │
│  ・更新頻度: 30日/60日/90日/手動のみ                           │
│  ・更新強度: 軽微のみ/中程度まで/大幅OK                        │
│  ・削除禁止セクション: 変更してはいけない箇所                  │
│  ・必須含有情報: 常に含めるべき情報                            │
│                                                                 │
│  [品質基準]                                                     │
│  ・最低文字数: 3000文字以上等                                  │
│  ・必須要素: FAQ必須/図解必須等                                │
│  ・トーン維持: 設定したペルソナの一貫性                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.4.4 更新強度設定

```
┌─────────────────────────────────────────────────────────────────┐
│                    更新強度レベル                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [Level 1: 軽微更新（Light）]                                   │
│  ・日付・数字の更新                                             │
│  ・リンク切れ修正                                               │
│  ・誤字脱字修正                                                 │
│  ・小さな事実更新                                               │
│  → 承認不要（自動実行可）                                       │
│                                                                 │
│  [Level 2: 中程度更新（Moderate）]                              │
│  ・新しいセクションの追加                                       │
│  ・既存セクションの拡充                                         │
│  ・新しい情報源の追加                                           │
│  ・競合に対抗する内容追加                                       │
│  → 要承認（差分プレビュー表示）                                 │
│                                                                 │
│  [Level 3: 大幅更新（Major）]                                   │
│  ・記事構成の変更                                               │
│  ・大幅な内容変更                                               │
│  ・新しい視点・アプローチの導入                                 │
│  ・キーワード戦略の変更                                         │
│  → 要承認（全体レビュー必須）                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.4.5 データモデル

```prisma
// 記事目標・哲学
model ArticleGoal {
  id                  String   @id @default(cuid())
  articleId           String   @unique
  article             Article  @relation(fields: [articleId], references: [id])

  // 基本目標
  targetAudience      String   // ターゲット読者
  primaryPurpose      String   // "education" | "sales" | "branding" | "lead_gen"
  coreMessage         String   @db.Text // 核心メッセージ

  // SEO目標
  primaryKeywords     String[] // 主要キーワード
  targetRank          Int?     // 目標順位
  competitorUrls      String[] // 競合URL

  // コンテンツ方針
  updateFrequencyDays Int      @default(60) // 更新頻度（日）
  maxUpdateIntensity  String   @default("moderate") // "light" | "moderate" | "major"
  protectedSections   String[] // 削除禁止セクション識別子
  requiredContent     String[] // 必須含有情報

  // 品質基準
  minWordCount        Int      @default(3000)
  requiredElements    String[] // ["faq", "images", "table"]
  personaId           String?  // 使用ペルソナ
  styleTraceId        String?  // 使用トレース

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

// リライト履歴
model ArticleRewriteHistory {
  id                  String   @id @default(cuid())
  articleId           String
  article             Article  @relation(fields: [articleId], references: [id])

  // リライト情報
  rewriteNumber       Int      // リライト回数（1, 2, 3...）
  triggerType         String   // "scheduled" | "gsc_alert" | "manual" | "event"
  triggerReason       String?  // トリガー理由

  // 更新内容
  updateIntensity     String   // "light" | "moderate" | "major"
  changesSummary      String   @db.Text // 変更サマリー
  sectionsAdded       String[] // 追加セクション
  sectionsRemoved     String[] // 削除セクション
  sectionsModified    String[] // 修正セクション

  // 差分データ
  previousContent     String   @db.Text // 更新前HTML
  newContent          String   @db.Text // 更新後HTML
  diffHtml            String?  @db.Text // 差分表示用HTML

  // 入力データ
  researchData        Json?    // Tavily検索結果
  competitorAnalysis  Json?    // 競合分析結果
  gscData             Json?    // GSCデータ

  // 承認フロー
  status              String   @default("draft") // "draft" | "pending_review" | "approved" | "published" | "rejected"
  reviewedAt          DateTime?
  publishedAt         DateTime?

  // 効果測定（公開後に更新）
  beforeMetrics       Json?    // 更新前のGSC指標
  afterMetrics        Json?    // 更新後のGSC指標

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

// スケジュール設定
model ArticleRewriteSchedule {
  id                  String   @id @default(cuid())
  articleId           String
  article             Article  @relation(fields: [articleId], references: [id])

  isActive            Boolean  @default(true)
  frequencyDays       Int      // 更新頻度（日）
  nextScheduledAt     DateTime // 次回予定日
  lastExecutedAt      DateTime?

  // GSCトリガー設定
  enableGscTrigger    Boolean  @default(false)
  gscRankDropThreshold Int?    // 順位低下閾値
  gscClickDropPercent Int?     // クリック低下率閾値

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}
```

#### 11.4.6 リライトパイプライン詳細

```typescript
// リライトパイプラインの入力
interface RewriteInput {
  articleId: string;
  triggerType: 'scheduled' | 'gsc_alert' | 'manual' | 'event';
  triggerReason?: string;

  // オプション: 強制設定
  forceIntensity?: 'light' | 'moderate' | 'major';
  focusAreas?: string[]; // 特に注力する領域
}

// リライトパイプラインの出力
interface RewriteOutput {
  rewriteHistoryId: string;
  originalContent: string;
  newContent: string;
  diffHtml: string;
  changesSummary: string;
  updateIntensity: 'light' | 'moderate' | 'major';
  researchSources: string[];
  competitorInsights: string[];
  requiresApproval: boolean;
}

// リライトパイプラインステップ
const REWRITE_PIPELINE_STEPS = [
  'R1_CURRENT_ANALYSIS',     // 現状分析
  'R2_INFORMATION_GATHERING', // 情報収集
  'R3_STRATEGY_DECISION',    // 方針決定
  'R4_CONTENT_UPDATE',       // コンテンツ更新
  'R5_DIFF_REVIEW',          // 差分レビュー生成
  'R6_PUBLISH_OR_QUEUE',     // 公開または承認待ち
];
```

#### 11.4.7 UI設計

```
┌─────────────────────────────────────────────────────────────────┐
│                   リライト管理画面                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [記事詳細ページ: /articles/:id]                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 記事タイトル: ○○の完全ガイド2026                         │   │
│  │ ───────────────────────────────────────────────────────  │   │
│  │ 最終更新: 2026-01-15  │  リライト回数: 3回               │   │
│  │ 次回予定: 2026-03-15  │  GSCスコア: 85/100               │   │
│  │ ───────────────────────────────────────────────────────  │   │
│  │                                                          │   │
│  │ [記事目標を編集] [今すぐリライト] [スケジュール設定]      │   │
│  │                                                          │   │
│  │ リライト履歴:                                            │   │
│  │ ┌────────────────────────────────────────────────────┐  │   │
│  │ │ #3 | 2026-01-15 | 中程度 | スケジュール | [差分表示] │  │   │
│  │ │ #2 | 2025-11-10 | 軽微   | GSCアラート  | [差分表示] │  │   │
│  │ │ #1 | 2025-09-05 | 大幅   | 手動         | [差分表示] │  │   │
│  │ └────────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [リライトダッシュボード: /articles/rewrite]                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ リライト待ち記事                              [一括実行]  │   │
│  │ ───────────────────────────────────────────────────────  │   │
│  │ ⏰ 期限超過（3件）                                        │   │
│  │   ├─ ○○完全ガイド   60日経過  [リライト開始]             │   │
│  │   ├─ △△の使い方     45日経過  [リライト開始]             │   │
│  │   └─ □□レビュー     35日経過  [リライト開始]             │   │
│  │                                                          │   │
│  │ ⚠️ GSCアラート（2件）                                     │   │
│  │   ├─ ◇◇比較記事   順位5位→12位  [詳細] [リライト]       │   │
│  │   └─ ◆◆入門      CTR -30%      [詳細] [リライト]       │   │
│  │                                                          │   │
│  │ 📝 承認待ち（1件）                                        │   │
│  │   └─ ○○ガイド    更新差分レビュー  [プレビュー] [承認]   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.4.8 GSC連携

```
┌─────────────────────────────────────────────────────────────────┐
│              GSC（Google Search Console）連携                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [連携機能]                                                     │
│  1. パフォーマンス監視                                          │
│     - 各記事のクリック数・インプレッション・順位を定期取得      │
│     - 過去データとの比較で変化を検知                            │
│                                                                 │
│  2. アラート生成                                                │
│     - 順位が閾値以下に低下 → リライトトリガー                  │
│     - CTRが急落 → リライト推奨通知                             │
│     - 新しい検索クエリ発見 → キーワード追加提案                │
│                                                                 │
│  3. 効果測定                                                    │
│     - リライト前後のパフォーマンス比較                          │
│     - ROI計算（リライトコスト vs 流入増加）                     │
│                                                                 │
│  [実装方式]                                                     │
│  - Google Search Console API v3                                 │
│  - OAuth 2.0認証（ユーザーごとに接続）                          │
│  - Inngestで定期データ取得（1日1回）                            │
│                                                                 │
│  [データモデル追加]                                             │
│  model GscConnection {                                          │
│    id            String   @id @default(cuid())                  │
│    userId        String   @unique                               │
│    siteUrl       String   // GSCで登録済みのサイトURL           │
│    accessToken   String   @db.Text                              │
│    refreshToken  String   @db.Text                              │
│    expiresAt     DateTime                                       │
│  }                                                              │
│                                                                 │
│  model GscMetrics {                                             │
│    id            String   @id @default(cuid())                  │
│    articleId     String                                         │
│    date          DateTime                                       │
│    clicks        Int                                            │
│    impressions   Int                                            │
│    ctr           Float                                          │
│    position      Float                                          │
│    topQueries    Json     // 上位検索クエリ                     │
│  }                                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.4.9 実装フェーズ

**推奨Phase:**
- **Phase 10 (Growth):** 基本リライト機能
- **Phase 11:** GSC連携・自動トリガー

**実装ステップ:**
1. ArticleGoal、ArticleRewriteHistory、ArticleRewriteScheduleテーブル追加
2. リライトパイプライン実装（R1〜R6）
3. リライト管理UI実装
4. Inngestでスケジュール実行
5. GSC API連携（OAuth、データ取得）
6. GSCトリガーロジック実装

---

### 11.5 キーワード分析連携（Keyword Intelligence）

#### 11.5.1 概要

キーワード選定の自動化・最適化を支援する機能。GSC、検索ボリュームAPI、競合分析を統合。

#### 11.5.2 システム構成

```
┌─────────────────────────────────────────────────────────────────┐
│                Keyword Intelligence System                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [入力ソース]                                                   │
│  ・GSC: 既存クエリ、インプレッション、順位                      │
│  ・Tavily: 関連キーワード発見                                   │
│  ・ユーザー入力: シードキーワード                               │
│                                                                 │
│  [分析エンジン]                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ K1. キーワードギャップ分析                                │   │
│  │     - GSCで見つかるが記事がないキーワード                 │   │
│  │     - 競合が上位だが自サイトがないキーワード              │   │
│  │                                                          │   │
│  │ K2. キーワードクラスタリング                              │   │
│  │     - 関連キーワードのグループ化                          │   │
│  │     - ピラーページ/クラスターコンテンツ提案               │   │
│  │                                                          │   │
│  │ K3. 優先度スコアリング                                    │   │
│  │     - 検索ボリューム × 競合難易度 × 関連性                │   │
│  │     - ROI予測                                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [出力]                                                         │
│  ・推奨キーワードリスト（優先度付き）                           │
│  ・記事生成への自動連携                                         │
│  ・キーワードカレンダー                                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.5.3 データモデル

```prisma
model KeywordSuggestion {
  id                  String   @id @default(cuid())
  siteId              String
  site                Site     @relation(fields: [siteId], references: [id])

  keyword             String
  searchVolume        Int?     // 月間検索ボリューム
  difficulty          Float?   // 競合難易度 (0-100)
  relevanceScore      Float    // 関連性スコア (0-1)
  priorityScore       Float    // 総合優先度 (0-100)

  source              String   // "gsc" | "tavily" | "competitor" | "manual"
  sourceData          Json?    // ソース詳細データ

  status              String   @default("suggested") // "suggested" | "planned" | "in_progress" | "completed" | "dismissed"
  articleId           String?  // 生成された記事ID
  plannedDate         DateTime?

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}
```

#### 11.5.4 実装フェーズ

**推奨Phase:** Phase 12 (G-4: GSC Integration)

---

## 12. 機能構成マップ

### 12.1 アセット管理方式の全体像

**設計原則:** ペルソナ・トレースは「事前登録→記事生成時に選択」方式で実装

```
┌─────────────────────────────────────────────────────────────────┐
│                アセット管理方式 - 全体フロー                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [事前登録フェーズ]                  [記事生成フェーズ]         │
│                                                                 │
│  ┌─────────────────────┐                                        │
│  │ ペルソナ管理画面     │            ┌─────────────────────┐   │
│  │ /settings/personas  │────┐       │ 記事生成画面         │   │
│  │                     │    │       │ /articles/new       │   │
│  │ ・プリセット選択    │    │       │                     │   │
│  │ ・カスタム作成      │    ├──────►│ ペルソナ: [選択▼]   │   │
│  │ ・編集・削除        │    │       │ トレース: [選択▼]   │   │
│  └─────────────────────┘    │       │ 商品CTA:  [選択▼]   │   │
│                              │       │                     │   │
│  ┌─────────────────────┐    │       │ キーワード:[入力]   │   │
│  │ トレース管理画面     │    │       │ 記事タイプ:[選択]   │   │
│  │ /settings/traces    │────┤       │                     │   │
│  │                     │    │       │      [生成開始]     │   │
│  │ ・URL解析で登録     │    │       └─────────────────────┘   │
│  │ ・テキスト解析で登録│    │                    │             │
│  │ ・編集・削除        │    │                    ▼             │
│  └─────────────────────┘    │       ┌─────────────────────┐   │
│                              │       │ ArticleGenerator    │   │
│  ┌─────────────────────┐    │       │                     │   │
│  │ 商品CTA管理画面     │    │       │ 選択されたアセット   │   │
│  │ /settings/products  │────┘       │ を適用して記事生成   │   │
│  │                     │            │                     │   │
│  │ ・商品情報登録      │            └─────────────────────┘   │
│  │ ・CTA設定           │                                        │
│  └─────────────────────┘                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 12.2 各機能の位置づけ

```
┌─────────────────────────────────────────────────────────────────┐
│                    機能構成マップ                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [既存機能]                    [新規機能]                       │
│                                                                 │
│  Soul Injection System ─────────────────► Writer Persona System│
│  (文体・トーン学習)                       (ペルソナ機能)         │
│                                           ★アセット管理方式      │
│                                           ★複数登録・選択可能    │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  ─────（新規独立モジュール）──────────► Writing Style Trace    │
│                                          (Trace機能)            │
│                                          ★完全独立モジュール     │
│                                          ★アセット管理方式       │
│                                          ★複数登録・選択可能     │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  ─────（新規追加）───────────────────► Product CTA System      │
│                                          (商品誘導機能)          │
│                                          ★アセット管理方式       │
│                                          ★複数登録・選択可能     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 12.3 記事生成時のアセット適用フロー

```
┌─────────────────────────────────────────────────────────────────┐
│                記事生成パイプラインへの適用                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [記事生成リクエスト]                                           │
│  {                                                              │
│    targetKeyword: "...",                                        │
│    personaId: "cuid_xxx",      // 選択したペルソナ              │
│    styleTraceId: "cuid_yyy",   // 選択したトレース              │
│    productCtaId: "cuid_zzz",   // 選択した商品CTA               │
│  }                                                              │
│                         │                                       │
│                         ▼                                       │
│  [Pipeline Step F3: コンテンツ生成]                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 1. ペルソナプロファイルを取得（personaId）              │   │
│  │ 2. トレーススタイルを取得（styleTraceId）               │   │
│  │ 3. プロンプトに両方を組み込んでLLM実行                  │   │
│  │    - トレースの文体・構成を優先適用                     │   │
│  │    - ペルソナの感情・人格を補完的に適用                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                         │                                       │
│                         ▼                                       │
│  [Pipeline Step F8: 商品CTA挿入]                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 1. 商品CTA設定を取得（productCtaId）                    │   │
│  │ 2. 記事末尾/文中にCTAセクションを挿入                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                         │                                       │
│                         ▼                                       │
│  [生成完了: 記事にアセットIDを記録]                             │
│  Article {                                                      │
│    personaId: "cuid_xxx",                                       │
│    styleTraceId: "cuid_yyy",                                    │
│    productCtaId: "cuid_zzz",                                    │
│  }                                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 12.4 管理画面の構成

| 画面 | パス | 機能 | 推奨Phase |
|------|------|------|-----------|
| ペルソナ管理 | `/settings/personas` | ペルソナの一覧・作成・編集・削除 | MVP |
| トレース管理 | `/settings/style-traces` | トレースの一覧・解析登録・削除 | Phase 10 |
| 商品CTA管理 | `/settings/products` | 商品情報・CTA設定の管理 | MVP |
| 記事生成 | `/articles/new` | 各アセットを選択して記事生成 | MVP |
| **記事目標設定** | `/articles/:id/goal` | 記事の目標・哲学・リライト方針 | Phase 10 |
| **リライト管理** | `/articles/rewrite` | リライト待ち・履歴・承認管理 | Phase 10 |
| **GSC連携** | `/settings/gsc` | Google Search Console接続・設定 | Phase 11 |
| **キーワード分析** | `/keywords` | キーワード提案・カレンダー | Phase 12 |

### 12.5 実装優先度（更新版）

| 順位 | 機能 | Phase | 理由 |
|------|------|-------|------|
| 1 | Transparency Footer | MVP | 実装が簡単、差別化効果大 |
| 2 | **Product CTA System** | **MVP** | **収益化に直結、実装容易** |
| 3 | **Writer Persona (基本)** | **MVP** | **ユーザー体験向上、低コスト** |
| 4 | Thought Map | Phase 10 | 戦略性向上、初回のみのコスト |
| 5 | Living Article | Phase 10 | 長期的SEO価値、継続コスト |
| 6 | **Writing Style Trace** | **Phase 10** | **独立モジュール、品質向上** |
| 7 | **Article Rewrite System** | **Phase 10-11** | **SEO必須機能、順位維持に直結** |
| 8 | **GSC Integration** | **Phase 11** | **リライト自動化の基盤** |
| 9 | **Keyword Intelligence** | **Phase 12** | **キーワード選定の効率化** |
| 10 | Vibe Writing | Phase 12 | UX革新、やや複雑 |

### 12.6 記事ライフサイクル全体像

```
┌─────────────────────────────────────────────────────────────────┐
│                    記事ライフサイクル管理                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [Phase 1: キーワード発見]                                      │
│  ┌───────────────────┐                                          │
│  │ Keyword           │ GSCデータ、競合分析、ユーザー入力        │
│  │ Intelligence      │ → 優先キーワードリスト                  │
│  └─────────┬─────────┘                                          │
│            │                                                    │
│            ▼                                                    │
│  [Phase 2: 記事生成]                                            │
│  ┌───────────────────┐                                          │
│  │ Article           │ キーワード + ペルソナ + CTA              │
│  │ Generator         │ → 高品質記事                            │
│  └─────────┬─────────┘                                          │
│            │                                                    │
│            ▼                                                    │
│  [Phase 3: 公開・目標設定]                                      │
│  ┌───────────────────┐                                          │
│  │ Article Goal      │ 目標読者、SEO目標、更新方針              │
│  │ Settings          │ → リライトの指針として使用              │
│  └─────────┬─────────┘                                          │
│            │                                                    │
│            ▼                                                    │
│  [Phase 4: パフォーマンス監視]                                  │
│  ┌───────────────────┐                                          │
│  │ GSC               │ クリック数、順位、CTR                    │
│  │ Integration       │ → アラート生成                          │
│  └─────────┬─────────┘                                          │
│            │                                                    │
│            ▼                                                    │
│  [Phase 5: リライト]                                            │
│  ┌───────────────────┐                                          │
│  │ Article           │ スケジュール/GSCトリガー/手動            │
│  │ Rewrite System    │ → 記事更新・最新化                      │
│  └─────────┬─────────┘                                          │
│            │                                                    │
│            └──────────────────► [Phase 4へ戻る（継続監視）]     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

*最終更新: 2026-01-29*
