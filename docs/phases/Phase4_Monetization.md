# Phase 4: Monetization（収益化）詳細仕様書

**テーマ:** Business Sustainability
**ゴール:** サブスクリプション決済を導入し、サービスを継続可能なビジネスとして成立させる。
**期間:** Week 9

---

## 1. 目的

「素晴らしいツールを無料で提供し続けること」ではなく、「適正な対価を得て、継続的な改善をユーザーに届けること」を実現します。

## 2. 実装ステップ

### Step 1: Stripe Checkout 連携

- Stripeを使用したセキュアな決済画面の導入。
- クレジットカード情報の保持をStripe側に任せることで、セキュリティリスク（PCI-DSS）を回避。

### Step 2: サブスクリプションDB設計

- `subscriptions` テーブルの構築（ステータス：active / trialing / canceledなど）。
- 課金状態に応じて、記事の生成数や機能を制限するロジックの実装。

### Step 3: Webhook 処理

- Stripeからの支払い完了、更新失敗、キャンセルなどのイベントを確実に受け取り、DBの状態を同期。
- 特に「支払いが途絶えた瞬間に即座に記事生成を停止する」が「ブログ自体は表示し続ける」という切り分けを実装。

### Step 4: カスタマーポータル

- ユーザーが自分でプラン変更や解約を行える「Stripe Customer Portal」への導線を設置。
- 管理者の手を煩わせない、セルフサービス型の管理体験。

---

## 3. セキュリティ & 実用性の考慮

- **Idempotency (冪等性):** ネットワークエラーによる二重課金を防ぐため、Stripeの冪等キーを利用。
- **透明性:** 課金が発生するタイミングや金額を、チェックアウト画面で明確に提示。

## 4. 成功基準

- テストカードでの決済〜サブスクリプション有効化〜解約のフローがミスなく完了すること。
- 課金していないユーザーが有償機能（記事生成など）にアクセスできないこと。
