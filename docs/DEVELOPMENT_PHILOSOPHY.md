# 開発哲学 (Development Philosophy)

> **本ドキュメントは Argo Note プロジェクトの最上位設計思想を定義します。**
> すべての技術的意思決定、アーキテクチャ設計、開発プロセスは本ドキュメントの原則に従うものとします。

---

## 0. 用語定義

本プロジェクトで使用する用語を明確に定義します。曖昧な用語の使用は禁止します。

### 基本用語

| 用語 | 定義 | 例 |
|------|------|-----|
| **Stream** | 単一機能を開発・テストするための**スタンドアローンアプリケーション**。他Streamに依存せず、完全に独立して動作する。 | Stream01, Stream02 |
| **単体開発** | 各Streamをスタンドアローンで開発すること。他Streamとの結合は行わない。 | Stream01の記事生成機能を独立して開発 |
| **単体テスト** | 各Streamが単独で正しく動作することを検証するテスト。他Streamとの連携は検証しない。 | Stream02でWordPressがセットアップできるかテスト |
| **結合テスト** | 複数のStreamを組み合わせた際の連携動作を検証するテスト。 | Stream01で生成した記事をStream02で投稿できるか |
| **統合** | 単体テスト・結合テスト完了後、各Streamのコアロジックを `/app/` に組み込むこと。 | `stream-01/src/lib/` → `app/src/lib/ai/` |
| **MVP** | Minimum Viable Product。**全Streamを統合した後の**最小限のプロダクト。単一Streamを指す言葉ではない。 | Stream01〜06を統合した初期リリース版 |

### 各Streamの責務（テスト目的）

| Stream | テスト目的 | 入力 | 出力 | 他Streamとの関係 |
|--------|-----------|------|------|-----------------|
| **Stream01** | 記事が生成できるか | キーワード、トピック | 生成された記事HTML/JSON | 完全独立 |
| **Stream02** | WordPressがセットアップでき、記事投稿機能が動作するか | ユーザー情報、サイト設定、**Mockデータ** | 構築済みWordPress環境 + 投稿済みテスト記事 | 完全独立 |
| **Stream03** | ユーザー認証ができるか | 認証情報 | 認証済みセッション | 完全独立 |
| **Stream04** | Stream間の連携ができるか | Stream01出力（実記事） + Stream02出力 | 実記事が投稿されたWordPress | Stream01, 02に依存 |

### 禁止事項（用語の誤用）

以下の用語の使い方は**禁止**します：

| 誤用 | 問題点 | 正しい表現 |
|------|--------|-----------|
| 「Stream02のMVP」 | StreamはMVPではない。単体開発フェーズである。 | 「Stream02の単体開発仕様」 |
| 「Stream01で記事を投稿」 | 記事投稿テストはStream02の責務 | 「Stream01で記事を生成」 |
| 「Stream02で記事を生成」 | 記事生成はStream01の責務 | 「Stream02でMockデータを使って投稿テスト」 |
| 「Stream02でStream01の記事を投稿」 | Stream01出力の使用はStream04の責務 | 「Stream04でStream01の記事を投稿」 |

### 機能範囲の定義

#### Stream02の責務範囲

Stream02は「WordPressがセットアップでき、記事投稿機能が動作するか」を検証する。

```
Stream02のテスト範囲:
1. VPSプロビジョニング（Hetzner API）
2. OS基盤設定（Nginx, PHP-FPM, MariaDB）
3. WordPressインストール
4. Multisite有効化
5. サブサイト作成
6. 認証情報発行（Application Password）
7. 記事投稿機能の動作確認 ← Mockデータを使用
```

**重要: 記事投稿テストにはMockデータを使用**

Stream02では記事の「内容」ではなく「投稿機能」をテストするため、
あらかじめ用意されたMockテキスト・Mock画像を使用する。

```typescript
// Stream02のテスト例
import { MOCK_ARTICLE, createMockArticleWithImage } from '@/lib/wordpress/mock-data';

// Mockデータで投稿テスト
await articlePublisher.publish(MOCK_ARTICLE);
```

**Stream02に含まれないもの:**
- 記事生成（実コンテンツの生成） → Stream01の責務
- Stream01の出力を使った記事投稿 → Stream04（結合フェーズ）の責務

---

## 1. 最終目的：統合された単一プロダクト

### 大前提

本プロジェクトの最終成果物は **統合された単一のプロダクト（Argo Note）** です。

以下で説明する「単体開発」「スタンドアロン」は、**品質の高い統合を実現するための手段**であり、目的ではありません。

### 開発フロー

```
単体開発 → 単体テスト → 結合テスト → 統合
```

このフローを前提として、各フェーズでの品質を担保します。

---

## 2. Service Per Pattern（サービス分離原則）

### 定義

各機能モジュールの開発は、**統合を最終目的として**、あたかも「単体で完結するプロダクト」であるかのように進めます。

これを **Service Per Pattern**（または Module Per Pattern）と呼びます。

### 重要な注意

**「別プロダクトとして開発」は手段であり、目的ではありません。**

- 目的：品質の高い統合、単体テストの容易さ、並行開発の実現
- 手段：独立したディレクトリ、独立した起動、独立したテスト

### 原則

1. **単体での動作確認**: 各モジュールは単独で起動・テストできること（統合前の品質担保）
2. **統合を前提とした設計**: インターフェース（入出力）は統合時の利用を想定して設計
3. **最小限の実装**: 統合に必要な機能のみ実装し、不要なモジュールは作らない
4. **統合フェーズの明確化**: 単体テスト完了後に結合テスト・統合を実施

### 適用対象

| モジュール | 役割 | 独立ディレクトリ | 統合先 |
|-----------|------|-----------------|--------|
| **Stream 01** | 記事生成エンジン | `/stream-01/` | `/app/src/lib/ai/` |
| **Stream 02** | WordPress セットアップ | `/stream-02/` | `/app/src/lib/wordpress/` |
| **Stream 13** | マーケティング・LP | `/stream-13/` | 独立運用 |
| **App** | 統合本番アプリケーション | `/app/` | - |

> 全ストリーム一覧は [STREAM_OVERVIEW.md](./STREAM_OVERVIEW.md) を参照

### アンチパターン（禁止事項）

以下は Service Per Pattern の誤った解釈です：

1. **完全に独立したプロダクトを作る**: 統合を考慮せず、独自の認証・DB・UIを構築してしまう
2. **統合時に不要なモジュールを含める**: 単体テスト用のスタブが本番に混入
3. **インターフェースの不一致**: 統合先の期待する入出力形式を無視した設計

---

## 3. スタンドアロン開発の目的

### なぜスタンドアロンで開発するのか

**すべては「品質の高い統合」のためです。**

1. **単体テストの容易さ**: 統合前に単一機能の品質を担保できる
2. **開発者による目視確認**: Web UI を通じて、統合前に動作を視覚的に検証できる
3. **問題の早期発見**: 統合後ではなく単体段階で問題を発見・修正できる
4. **並行開発**: 複数の開発者・AIエージェントが同時に異なるモジュールを開発できる

### スタンドアロン開発の要件

各スタンドアロンモジュールは以下を満たすこと：

```
/stream-{x}/
├── package.json          # 独立した依存関係（統合先と互換性を保つ）
├── tsconfig.json         # 独立した TypeScript 設定
├── .env.example          # 必要な環境変数のテンプレート
├── src/
│   ├── app/              # Web UI（単体テスト用・統合時は不要）
│   └── lib/              # コア機能ロジック（★統合対象）
└── README.md             # モジュール固有のドキュメント
```

**重要**: `src/lib/` 配下のコアロジックのみが統合対象です。`src/app/` の Web UI は単体テスト用であり、統合時には含めません。

---

## 4. Web UI の役割（単体テスト用）

### 開発時 Web UI の目的

Web UI（スタブ UI）は**単体テスト時に開発者が目視で状態を確認するため**に存在します。

**統合時には Web UI は含めません。コアロジック（`src/lib/`）のみが統合対象です。**

これは以下を意味します：

1. **単体テスト専用**: 統合前の動作検証用であり、本番には含めない
2. **機能確認が優先**: デザインより機能動作の可視化を優先
3. **独立して起動**: 本番アプリ (`/app/`) とは別ポートで独立起動
4. **最小限の実装**: 確認に必要な最小限の UI のみ（過剰な作り込みは禁止）

### スタブ UI の実装方針

```
開発時の起動構成例:

localhost:3000  → /app/          # 本番統合アプリ（Supabase Auth あり）
localhost:3001  → /stream-01/    # Stream 01 スタンドアロン（認証なし）
localhost:3002  → /stream-02/    # Stream 02 スタンドアロン（認証なし）
```

---

## 5. 統合フェーズの原則

### 統合のタイミング

各モジュールは以下の条件を満たした後に統合を行う：

1. **単体テストが全てパス**すること
2. **開発者が Web UI で動作確認済み**であること
3. **統合先のインターフェースに適合**していること

### 統合の方法

**コアロジック（`src/lib/`）のみを統合します。Web UI（`src/app/`）は含めません。**

```
統合前（単体開発）:
/stream-01/src/lib/ai/        # ★コアロジック（統合対象）
/stream-01/src/app/           # 単体テスト用 UI（統合しない）

/stream-02/src/lib/wordpress/ # ★コアロジック（統合対象）
/stream-02/src/app/           # 単体テスト用 UI（統合しない）

統合後:
/app/src/lib/ai/              # Stream 01 コアロジックを統合
/app/src/lib/wordpress/       # Stream 02 コアロジックを統合
/app/src/app/                 # 本番 UI（統合アプリ専用）
```

### 結合テスト

統合後は結合テストを実施し、モジュール間の連携が正常に動作することを確認します。

---

## 6. 本ドキュメントの位置づけ

```
ドキュメント階層:

DEVELOPMENT_PHILOSOPHY.md     ← 最上位（本ドキュメント）
    ↓ 従う
STREAM_OVERVIEW.md            ← 全ストリーム一覧と計画
    ↓ 従う
各ストリームドキュメント        ← 実装詳細
(Stream01_*.md, Stream02_*.md, ...)
```

すべての技術的意思決定は、本ドキュメントの原則に**矛盾しない**ことを確認した上で行うこと。

---

## 7. 原則の例外

以下の場合に限り、Service Per Pattern の例外を認める：

1. **共有ユーティリティ**: 純粋な型定義、共通定数など、ビジネスロジックを含まないもの
2. **緊急の本番修正**: 本番障害対応時の一時的な例外（後日リファクタリング必須）

例外を適用する場合は、必ず**理由を文書化**すること。

---

## 改訂履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-30 | Stream02の責務範囲を拡張。記事投稿機能テスト（Mockデータ使用）を追加 |
| 2026-01-30 | 用語定義セクション追加。Stream/MVP/単体開発/セットアップ範囲を明確化 |
| 2026-01-30 | ストリーム番号体系をアルファベットから数字に変更 |
| 2026-01-30 | 初版作成。Service Per Pattern、スタンドアロン開発の原則を定義 |
